{
  "info": {
    "name": "TechScope Search Engine API",
    "description": "Collection of API requests untuk Gateway Search Engine dengan Conditional Logging",
    "version": "1.0.0",
    "timestamp": "2025-11-29"
  },
  "servers": [
    {
      "url": "http://localhost:5000",
      "description": "Development Server"
    }
  ],
  "auth": {
    "type": "Bearer",
    "description": "JWT Token dari /api/auth/login"
  },
  "requests": [
    {
      "name": "1. Guest Search (Tanpa Token)",
      "method": "POST",
      "url": "http://localhost:5000/api/search",
      "description": "Search tanpa login - hasil TIDAK disimpan ke history",
      "headers": {
        "Content-Type": "application/json"
      },
      "body": {
        "query": "iphone 14 pro"
      },
      "expectedResponse": {
        "success": true,
        "data": {
          "query": "iphone 14 pro",
          "processedQuery": "iphone pro",
          "results": []
        },
        "historyId": null,
        "message": "Search completed (not saved - unauthenticated user)"
      },
      "notes": [
        "Tidak perlu Authorization header",
        "historyId akan null (tidak disimpan)",
        "Response cepat karena tidak ada DB write"
      ]
    },
    {
      "name": "2. Authenticated Search (Dengan Token)",
      "method": "POST",
      "url": "http://localhost:5000/api/search",
      "description": "Search dengan login - hasil DISIMPAN ke history",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      },
      "body": {
        "query": "samsung galaxy s23"
      },
      "expectedResponse": {
        "success": true,
        "data": {
          "query": "samsung galaxy s23",
          "processedQuery": "samsung",
          "results": []
        },
        "historyId": "hist_550e8400-e29b-41d4-a716-446655440000",
        "message": "Search completed and saved to history"
      },
      "notes": [
        "Harus include Authorization header dengan valid token",
        "historyId akan berisi UUID (disimpan ke DB)",
        "Response sedikit lebih lambat karena DB write"
      ]
    },
    {
      "name": "3. Get Search History (Pagination)",
      "method": "GET",
      "url": "http://localhost:5000/api/search/history/user_550e8400-e29b-41d4-a716-446655440000?limit=10&offset=0",
      "description": "Ambil riwayat pencarian user dengan pagination",
      "headers": {
        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "Content-Type": "application/json"
      },
      "queryParams": {
        "limit": 10,
        "offset": 0
      },
      "expectedResponse": {
        "success": true,
        "data": [
          {
            "id": "hist_1",
            "userId": "user_550e8400-e29b-41d4-a716-446655440000",
            "query": "iphone 14",
            "processedQuery": "iphone",
            "resultsJson": {},
            "createdAt": "2025-11-29T10:30:00Z"
          }
        ],
        "pagination": {
          "total": 150,
          "limit": 10,
          "offset": 0,
          "hasMore": true
        }
      },
      "notes": [
        "userId di URL harus sesuai dengan token",
        "Akan error 403 jika coba akses history user lain",
        "Default limit=20, offset=0 jika tidak specify"
      ]
    },
    {
      "name": "4. Delete Single History",
      "method": "DELETE",
      "url": "http://localhost:5000/api/search-history/hist_550e8400-e29b-41d4-a716-446655440001",
      "description": "Hapus satu riwayat pencarian",
      "headers": {
        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "Content-Type": "application/json"
      },
      "body": {
        "userId": "user_550e8400-e29b-41d4-a716-446655440000"
      },
      "expectedResponse": {
        "success": true,
        "message": "Search history deleted successfully"
      },
      "notes": [
        "historyId di URL adalah ID yang ingin dihapus",
        "userId di body untuk verifikasi ownership"
      ]
    },
    {
      "name": "5. Clear All History",
      "method": "DELETE",
      "url": "http://localhost:5000/api/search-history/clear/user_550e8400-e29b-41d4-a716-446655440000",
      "description": "Hapus SEMUA riwayat pencarian user",
      "headers": {
        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "Content-Type": "application/json"
      },
      "body": {
        "userId": "user_550e8400-e29b-41d4-a716-446655440000"
      },
      "expectedResponse": {
        "success": true,
        "message": "All search histories cleared successfully",
        "data": {
          "deletedCount": 45
        }
      },
      "notes": [
        "Operasi ini tidak bisa di-undo!",
        "Semua history user akan dihapus"
      ]
    },
    {
      "name": "6. Save History Manually",
      "method": "POST",
      "url": "http://localhost:5000/api/search-history",
      "description": "Simpan search history secara manual (alternatif)",
      "headers": {
        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "Content-Type": "application/json"
      },
      "body": {
        "userId": "user_550e8400-e29b-41d4-a716-446655440000",
        "query": "macbook pro m3",
        "processedQuery": "macbook",
        "resultsJson": {
          "query": "macbook pro m3",
          "results": [],
          "metadata": {
            "executionTime": 120,
            "totalResults": 25
          }
        }
      },
      "expectedResponse": {
        "success": true,
        "message": "Search history saved successfully",
        "data": {
          "id": "hist_550e8400-e29b-41d4-a716-446655440002",
          "userId": "user_550e8400-e29b-41d4-a716-446655440000",
          "query": "macbook pro m3",
          "processedQuery": "macbook",
          "resultsJson": {},
          "createdAt": "2025-11-29T10:35:00Z"
        }
      },
      "notes": [
        "Alternatif untuk save history dengan API terpisah",
        "Biasanya digunakan untuk batched operations"
      ]
    }
  ],
  "errorScenarios": [
    {
      "name": "Error: Missing Query",
      "method": "POST",
      "url": "http://localhost:5000/api/search",
      "body": {},
      "expectedStatus": 400,
      "expectedResponse": {
        "success": false,
        "message": "Query is required and must be a non-empty string"
      }
    },
    {
      "name": "Error: Invalid Token",
      "method": "POST",
      "url": "http://localhost:5000/api/search",
      "headers": {
        "Authorization": "Bearer invalid_token"
      },
      "body": {
        "query": "test"
      },
      "expectedStatus": 401,
      "expectedResponse": {
        "status": 401,
        "message": "Invalid token"
      }
    },
    {
      "name": "Error: Accessing Other User's History",
      "method": "GET",
      "url": "http://localhost:5000/api/search/history/user_other_person",
      "headers": {
        "Authorization": "Bearer token_for_user_123"
      },
      "expectedStatus": 403,
      "expectedResponse": {
        "success": false,
        "message": "Unauthorized to view this user's history"
      }
    },
    {
      "name": "Error: User Not Found",
      "method": "GET",
      "url": "http://localhost:5000/api/search/history/user_nonexistent",
      "headers": {
        "Authorization": "Bearer valid_token"
      },
      "expectedStatus": 404,
      "expectedResponse": {
        "success": false,
        "message": "User not found"
      }
    }
  ],
  "testScenarios": [
    {
      "name": "Test: Conditional Logging Flow",
      "steps": [
        {
          "step": 1,
          "action": "POST /api/search",
          "data": "query: 'iphone'",
          "expected": "historyId: null (guest search)"
        },
        {
          "step": 2,
          "action": "Login & get token",
          "data": "POST /api/auth/login",
          "expected": "token acquired"
        },
        {
          "step": 3,
          "action": "POST /api/search",
          "data": "query: 'samsung', with token",
          "expected": "historyId: 'xxx' (authenticated search)"
        },
        {
          "step": 4,
          "action": "GET /api/search/history/user_id",
          "data": "with token",
          "expected": "array dengan 1 item (samsung search)"
        }
      ]
    }
  ],
  "cURLExamples": {
    "guestSearch": "curl -X POST http://localhost:5000/api/search -H 'Content-Type: application/json' -d '{\"query\": \"iphone\"}'",
    "authenticatedSearch": "curl -X POST http://localhost:5000/api/search -H 'Content-Type: application/json' -H 'Authorization: Bearer TOKEN' -d '{\"query\": \"samsung\"}'",
    "getHistory": "curl -X GET 'http://localhost:5000/api/search/history/USER_ID?limit=10&offset=0' -H 'Authorization: Bearer TOKEN'",
    "deleteHistory": "curl -X DELETE http://localhost:5000/api/search-history/HISTORY_ID -H 'Authorization: Bearer TOKEN' -H 'Content-Type: application/json' -d '{\"userId\": \"USER_ID\"}'",
    "clearAllHistory": "curl -X DELETE http://localhost:5000/api/search-history/clear/USER_ID -H 'Authorization: Bearer TOKEN' -H 'Content-Type: application/json' -d '{\"userId\": \"USER_ID\"}'"
  },
  "notes": [
    "Ganti TOKEN dengan JWT token dari login",
    "Ganti USER_ID dengan UUID dari user yang login",
    "Ganti HISTORY_ID dengan UUID dari history record",
    "Query dapat berupa apapun (product name, features, dll)",
    "resultsJson berisi response dari Flask API",
    "processedQuery adalah hasil preprocessing NLP dari Flask"
  ]
}
